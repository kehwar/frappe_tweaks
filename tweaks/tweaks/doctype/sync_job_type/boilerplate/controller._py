# Copyright (c) {year}, {app_publisher} and contributors
# For license information, please see license.txt

import frappe
from frappe.model.document import Document

# BYPASS MODE: Define this function to have full control
# def execute(sync_job, source_doc):
# 	"""
# 	Execute sync job with full control
#
# 	NOTE: In bypass mode, you are responsible for handling dry run mode yourself.
# 	      Check sync_job.get("dry_run") to avoid making database changes when in dry run.
#
# 	Args:
# 		sync_job: Sync Job document
# 		source_doc: Source document
#
# 	Returns:
# 		Dict with keys:
# 			target_doc: Target document (saved or unsaved)
# 			operation: "insert", "update", or "delete"
# 			diff: Dict of changes (optional)
# 	"""
# 	# Context can be retrieved via sync_job.get_context()
# 	# context = sync_job.get_context()
# 	pass


# STANDARD MODE: Define these functions for framework-handled flow

# Optional: Return multiple targets (creates child jobs if > 1)
# def get_multiple_target_documents(sync_job, source_doc):
# 	"""
# 	Get multiple target documents for this source
#
# 	NOTE: This hook runs even in dry run mode.
# 	NOTE: Avoid making database changes here - only query and return targets.
# 	NOTE: Do not return the doc object itself, as this will be serialized to new jobs.
#
# 	Args:
# 		sync_job: Sync Job document (contains operation, context, and flags)
# 		source_doc: Source document
#
# 	Returns:
# 		List of dicts with keys:
# 			target_document_type: DocType name of target
# 			target_document_name: Name of target document (None for insert operations)
# 			operation: "insert", "update", or "delete"
# 			context: Dict of context for this target (optional)
# 	"""
# 	return []


# Required: Get single target document
def get_target_document(sync_job, source_doc):
    """
    Get target document for sync

    NOTE: This hook runs even in dry run mode.
    NOTE: Avoid making database changes here - only query and return the target.

    Args:
            sync_job: Sync Job document (contains operation, context, and flags)
            source_doc: Source document

    Returns:
            Dict with keys:
                operation: "insert", "update", or "delete" (required)
                target_document_type: DocType name of target (optional - uses sync_job_type default if not provided)
                target_document_name: Name of target document (required for update/delete, optional for insert)
                context: Dict of context for this target (optional - overrides existing context)
    """
    # Example implementation
    
    # Try to find existing target
    # target_name = frappe.db.get_value("Target DocType", {{"link_field": source_doc.name}})
    # if target_name:
    #     return {{
    #         "operation": "update",
    #         "target_document_name": target_name,
    #         # target_document_type is optional - will use sync_job_type's target if not provided
    #     }}
    # else:
    #     return {{
    #         "operation": "insert",
    #         # target_document_type is optional - will use sync_job_type's target if not provided
    #         # target_document_name is optional for insert - will be set after save
    #     }}

    pass



# Required: Update target document
def update_target_doc(sync_job, source_doc, target_doc):
    """
    Update target document with data from source

    NOTE: This hook runs even in dry run mode.
    NOTE: Avoid making database changes here - only update field values on target_doc.

    Args:
            sync_job: Sync Job document (contains operation and context)
            source_doc: Source document
            target_doc: Target document to update
    """
    pass


# Optional: After start hook
# def after_start(sync_job, source_doc):
# 	"""
# 	Hook called after job starts (after status changes to "Started")
#
# 	NOTE: This hook runs even in dry run mode.
# 	NOTE: Use this for initialization logic before sync execution begins.
# 	NOTE: Context can be retrieved via sync_job.get_context()
#
# 	Args:
# 		sync_job: Sync Job document
# 		source_doc: Source document
# 	"""
# 	pass


# Optional: Before relay hook (for multiple targets)
# def before_relay(sync_job, source_doc, targets):
# 	"""
# 	Hook called before child jobs are queued (when get_multiple_target_documents returns > 1 target)
#
# 	NOTE: This hook runs even in dry run mode.
# 	NOTE: Use this to perform validation or modifications before child jobs are created.
# 	NOTE: Context can be retrieved via sync_job.get_context()
#
# 	Args:
# 		sync_job: Sync Job document (parent job)
# 		source_doc: Source document
# 		targets: List of target dicts that will be used to create child jobs
# 	"""
# 	pass


# Optional: After relay hook (for multiple targets)
# def after_relay(sync_job, source_doc, child_jobs):
# 	"""
# 	Hook called after child jobs are queued (when get_multiple_target_documents returns > 1 target)
#
# 	NOTE: This hook runs even in dry run mode.
# 	NOTE: Use this to perform cleanup or tracking after child jobs are created.
# 	NOTE: Context can be retrieved via sync_job.get_context()
#
# 	Args:
# 		sync_job: Sync Job document (parent job with status "Relayed")
# 		source_doc: Source document
# 		child_jobs: List of dicts containing info about created child jobs
# 			Each dict has: target_document_type, target_document_name, operation, context, sync_job
# 	"""
# 	pass


# Optional: Before sync hook
# def before_sync(sync_job, source_doc, target_doc):
# 	"""
# 	Hook called before sync (before save)
#
# 	NOTE: This hook does NOT run in dry run mode.
#
# 	Args:
# 		sync_job: Sync Job document (contains operation and context)
# 		source_doc: Source document
# 		target_doc: Target document (not yet saved)
# 	"""
# 	pass


# Optional: After sync hook
# def after_sync(sync_job, source_doc, target_doc):
# 	"""
# 	Hook called after sync (after save)
#
# 	NOTE: This hook does NOT run in dry run mode.
#
# 	Args:
# 		sync_job: Sync Job document (contains operation and context)
# 		source_doc: Source document
# 		target_doc: Target document (saved)
# 	"""
# 	pass


# Optional: Finished hook
# def finished(sync_job, source_doc, target_doc):
# 	"""
# 	Hook called when sync job finishes successfully (status = "Finished" or "Skipped" or "Relayed")
#
# 	NOTE: This hook runs even in dry run mode (when status is "Skipped")
# 	NOTE: For relayed jobs (multiple targets), target_doc will be None
# 	NOTE: Use this for post-processing, notifications, or cleanup after sync.
# 	NOTE: Context can be retrieved via sync_job.get_context()
#
# 	Args:
# 		sync_job: Sync Job document (status = "Finished" or "Skipped" or "Relayed")
# 		source_doc: Source document
# 		target_doc: Target document (saved) or None for relayed jobs
# 	"""
# 	pass
