# Copyright (c) {year}, {app_publisher} and contributors
# For license information, please see license.txt

import frappe
from frappe.model.document import Document

# BYPASS MODE: Define this function to have full control
# def execute(sync_job, source_doc, filters, context):
# 	"""
# 	Execute sync job with full control
#
# 	NOTE: In bypass mode, you are responsible for handling dry run mode yourself.
# 	      Check sync_job.get("dry_run") to avoid making database changes when in dry run.
#
# 	Args:
# 		sync_job: Sync Job document
# 		source_doc: Source document
# 		filters: Dict of filters
# 		context: Dict of context data
#
# 	Returns:
# 		Dict with keys:
# 			target_doc: Target document (saved or unsaved)
# 			operation: "insert", "update", or "delete"
# 			diff: Dict of changes (optional)
# 	"""
# 	pass


# STANDARD MODE: Define these functions for framework-handled flow

# Optional: Return multiple targets (creates child jobs if > 1)
# def get_multiple_target_documents(sync_job, source_doc):
# 	"""
# 	Get multiple target documents for this source
#
# 	NOTE: This hook runs even in dry run mode.
# 	NOTE: Avoid making database changes here - only query and return targets.
# 	NOTE: Do not return the doc object itself, as this will be serialized to new jobs.
#
# 	Args:
# 		sync_job: Sync Job document (contains operation, context, and flags)
# 		source_doc: Source document
#
# 	Returns:
# 		List of dicts with keys:
# 			target_document_type: DocType name of target
# 			target_document_name: Name of target document (None for insert operations)
# 			operation: "insert", "update", or "delete"
# 			context: Dict of context for this target (optional)
# 	"""
# 	return []


# Required: Get single target document
def get_target_document(sync_job, source_doc):
    """
    Get target document for sync

    NOTE: This hook runs even in dry run mode.
    NOTE: Avoid making database changes here - only query and return the target.

    Args:
            sync_job: Sync Job document (contains operation, context, and flags)
            source_doc: Source document

    Returns:
            Dict with keys:
                operation: "insert", "update", or "delete" (required)
                target_document_type: DocType name of target (optional - uses sync_job_type default if not provided)
                target_document_name: Name of target document (required for update/delete, optional for insert)
                context: Dict of context for this target (optional - overrides existing context)
    """
    # Example implementation
    
    # Try to find existing target
    # target_name = frappe.db.get_value("Target DocType", {{"link_field": source_doc.name}})
    # if target_name:
    #     return {{
    #         "operation": "update",
    #         "target_document_name": target_name,
    #         # target_document_type is optional - will use sync_job_type's target if not provided
    #     }}
    # else:
    #     return {{
    #         "operation": "insert",
    #         # target_document_type is optional - will use sync_job_type's target if not provided
    #         # target_document_name is optional for insert - will be set after save
    #     }}

    pass



# Required: Update target document
def update_target_doc(sync_job, source_doc, target_doc):
    """
    Update target document with data from source

    NOTE: This hook runs even in dry run mode.
    NOTE: Avoid making database changes here - only update field values on target_doc.

    Args:
            sync_job: Sync Job document (contains operation and context)
            source_doc: Source document
            target_doc: Target document to update
    """
    pass


# Optional: Before sync hook
# def before_sync(sync_job, source_doc, target_doc):
# 	"""
# 	Hook called before sync (before save)
#
# 	NOTE: This hook does NOT run in dry run mode.
#
# 	Args:
# 		sync_job: Sync Job document (contains operation and context)
# 		source_doc: Source document
# 		target_doc: Target document (not yet saved)
# 	"""
# 	pass


# Optional: After sync hook
# def after_sync(sync_job, source_doc, target_doc):
# 	"""
# 	Hook called after sync (after save)
#
# 	NOTE: This hook does NOT run in dry run mode.
#
# 	Args:
# 		sync_job: Sync Job document (contains operation and context)
# 		source_doc: Source document
# 		target_doc: Target document (saved)
# 	"""
# 	pass
