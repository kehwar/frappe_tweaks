# Query Filters Report

## Overview

The Query Filters report lists all Query Filter documents in the system along with their calculated SQL expressions. This is useful for debugging and understanding how Query Filters are being evaluated in different contexts.

## Features

- Lists all Query Filters in the system
- Shows calculated SQL for each filter
- Supports user impersonation to see how filters evaluate for different users
- Displays filter metadata (name, type, reference doctype/report, disabled status)
- Handles errors gracefully by showing error messages in the calculated SQL column

## Columns

| Column | Description |
|--------|-------------|
| Name | Link to the Query Filter document |
| Filter Name | Human-readable name of the filter |
| Reference DocType | The DocType this filter applies to (if any) |
| Reference Report | The Report this filter applies to (if any) |
| Reference Document | Specific document name (for single-record filters) |
| Type | Filter type: JSON, Python, or SQL |
| Disabled | Whether the filter is disabled |
| Calculated SQL | The SQL WHERE clause generated by the filter |

## Filters

### Impersonate User

Optional filter to run the report as a different user. This is useful for:

- Testing how filters evaluate for specific users
- Debugging permission-related issues
- Understanding context-dependent filter behavior

When this filter is set, the report will:
1. Switch to the specified user's context
2. Calculate SQL for each Query Filter as that user
3. Switch back to your user after all calculations are complete

**Note:** The user impersonation only affects SQL calculation within this report. It does not affect any other system operations.

## Usage Examples

### View All Query Filters

Simply open the report without any filters to see all Query Filters and their calculated SQL.

### Test Filter as Another User

1. Open the Query Filters report
2. Set the "Impersonate User" filter to the user you want to test
3. Click "Refresh" to see how filters evaluate for that user

This is particularly useful for filters that use:
- `frappe.session.user` in Python code
- User-specific context in SQL expressions
- Dynamic filtering based on user properties

## Error Handling

If a filter encounters an error during SQL calculation, the error message will be displayed in the "Calculated SQL" column with the prefix "ERROR:". This helps identify:

- Syntax errors in filter definitions
- Missing reference doctypes
- Invalid filter configurations
- Runtime errors in Python filters

## Related Documentation

- Query Filter DocType: `tweaks/tweaks/doctype/query_filter/`
- AC Rule System: See `.github/instructions/ac-rule.instructions.md`
- Filter Types: JSON, Python, and SQL filter documentation

## Permissions

This report requires the **System Manager** role.
